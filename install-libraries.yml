parameters:
- name: libraries
  default: []
- name: env_key
  default: ''

steps:
- ${{ each tool_pair in parameters.libraries }}:
  - ${{ each library in tool_pair.value }}:

    - ${{ if and(eq(tool_pair.key, 'brew'), eq(env_key, 'macos')) }}:
      - script: brew install ${{ library }}
        displayName: Installing ${{ library }} with brew

    - ${{ if and(eq(tool_pair.key, 'brew-cask'), eq(env_key, 'macos')) }}:
      - script: brew cask install ${{ library }}
        displayName: Installing ${{ library }} with brew cask

    - ${{ if and(eq(tool_pair.key, 'apt'), eq(env_key, 'linux')) }}:
      - script: sudo apt-get install -y ${{ library }}
        displayName: Installing ${{ library }} with apt

    - ${{ if and(eq(tool_pair.key, 'yum'), or(eq(env_key, 'linux32'), eq(env_key, 'manylinux'))) }}:
      - script: docker exec -i -w /project ${{ variables.docker_name }} ${{ variables.setarch }} yum install -y ${{ library }}
        displayName: Installing ${{ library }} with yum

    - ${{ if and(eq(tool_pair.key, 'choco'), eq(env_key, 'windows')) }}:
      - script: choco install ${{ library }}
        displayName: Installing ${{ library }} with choco
